<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>Life Garden | ãƒ©ã‚¤ãƒ•ã‚²ãƒ¼ãƒ è‚²æˆãƒ‘ã‚ºãƒ«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description"
    content="Life Gardenã¯ã€ã‚»ãƒ«ãƒ»ã‚ªãƒ¼ãƒˆãƒãƒˆãƒ³ã€ãƒ©ã‚¤ãƒ•ã‚²ãƒ¼ãƒ ã€ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸãƒ–ãƒ©ã‚¦ã‚¶ã‚²ãƒ¼ãƒ ã§ã™ã€‚ç¨®ã‚’é…ç½®ã—ã¦ä¸–ä»£ã‚’é€²ã‚ã€ã©ã‚Œã ã‘é•·ããƒ»åºƒããƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¶­æŒã§ãã‚‹ã‹ã‚’ç«¶ã„ã¾ã™ã€‚">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Zen+Kaku+Gothic+New:wght@400;700&display=swap"
    rel="stylesheet">

  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6799951658165737"
    crossorigin="anonymous"></script>

  <style>
    :root {
      --bg-color: #0a0a0f;
      --primary-color: #b249f8;
      /* Neon Purple */
      --secondary-color: #49f8f8;
      /* Neon Cyan */
      --text-color: #f0f0f5;
      --glass-bg: rgba(20, 20, 30, 0.7);
      --glass-border: rgba(255, 255, 255, 0.1);
      --section-bg: rgba(30, 30, 40, 0.5);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      font-family: 'Zen Kaku Gothic New', 'Outfit', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      width: 100%;
      height: 100%;
      overflow-x: hidden;
      /* Prevent horizontal scroll */
    }

    body {
      overflow-y: auto;
      /* Allow scrolling initially */
    }

    body.game-mode {
      overflow: hidden;
      /* No scroll in game mode */
    }

    /* CANVAS BACKGROUND */
    #game-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    /* --- CONTENT SCROLL LAYER --- */
    #content-layer {
      position: relative;
      z-index: 10;
      width: 100%;
      min-height: 100vh;
      pointer-events: auto;
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .hidden {
      opacity: 0 !important;
      pointer-events: none !important;
      display: none !important;
      /* Hide to prevent layout issues */
    }

    /* HERO SECTION */
    .hero-section {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
      position: relative;
    }

    .hero-card {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 3rem 4rem;
      border-radius: 24px;
      border: 1px solid var(--glass-border);
      max-width: 800px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      margin-bottom: 2rem;
    }

    h1 {
      font-family: 'Outfit', sans-serif;
      font-size: 3.5rem;
      margin: 0 0 1rem;
      background: linear-gradient(135deg, #fff 30%, var(--primary-color) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(178, 73, 248, 0.4);
    }

    .subtitle {
      font-size: 1.2rem;
      line-height: 1.8;
      margin-bottom: 2.5rem;
      opacity: 0.9;
    }

    .btn-start {
      background: linear-gradient(135deg, var(--primary-color), #7c24cc);
      color: white;
      border: none;
      padding: 1.2rem 4rem;
      font-size: 1.4rem;
      font-weight: 700;
      border-radius: 999px;
      cursor: pointer;
      box-shadow: 0 0 20px rgba(178, 73, 248, 0.4);
      transition: transform 0.2s, box-shadow 0.2s;
      text-decoration: none;
      display: inline-block;
      font-family: 'Outfit', sans-serif;
    }

    .btn-start:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(178, 73, 248, 0.6);
    }

    .privacy-link-container {
      margin-top: 1.5rem;
      font-size: 0.85rem;
      opacity: 0.7;
    }

    .privacy-link-container a {
      color: #fff;
      text-decoration: none;
      border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      transition: color 0.2s;
    }

    .privacy-link-container a:hover {
      color: var(--secondary-color);
      border-bottom-color: var(--secondary-color);
    }

    /* CONTENT SECTIONS */
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 4rem 1.5rem;
    }

    section {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 2.5rem;
      margin-bottom: 3rem;
      border: 1px solid var(--glass-border);
    }

    h2 {
      font-size: 1.8rem;
      margin-top: 0;
      border-left: 4px solid var(--primary-color);
      padding-left: 1rem;
      color: var(--secondary-color);
    }

    h3 {
      font-size: 1.4rem;
      margin-top: 2rem;
      color: #fff;
    }

    p,
    li {
      line-height: 1.8;
      opacity: 0.9;
    }

    .note {
      background: rgba(178, 73, 248, 0.15);
      border-left: 3px solid var(--primary-color);
      padding: 1rem;
      border-radius: 8px;
      margin: 1.5rem 0;
      font-size: 0.95rem;
    }

    /* --- GAME UI LAYERS (Visible only in Game Mode) --- */
    #game-interface {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 20;
      pointer-events: none;
      /* Let clicks pass to canvas/buttons */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    /* HUD */
    #hud {
      padding: 20px;
      display: flex;
      justify-content: space-between;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent);
    }

    .score-display {
      text-align: left;
    }

    .score-val {
      font-size: 2rem;
      font-weight: 800;
      font-family: 'Outfit', sans-serif;
    }

    .score-label {
      font-size: 0.8rem;
      opacity: 0.7;
      letter-spacing: 0.1em;
    }

    /* Controls */
    #controls {
      padding: 30px;
      display: flex;
      justify-content: center;
      gap: 20px;
      pointer-events: auto;
    }

    .ctrl-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(30, 30, 40, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      font-size: 1.5rem;
      cursor: pointer;
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .ctrl-btn:hover {
      background: var(--primary-color);
      transform: scale(1.1);
    }

    .ctrl-btn.active {
      background: var(--primary-color);
      box-shadow: 0 0 15px var(--primary-color);
    }

    /* EXIT BUTTON */
    #btn-exit {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 0.5rem 1rem;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      border-radius: 99px;
      cursor: pointer;
      pointer-events: auto;
      backdrop-filter: blur(5px);
      z-index: 30;
    }

    /* RESULT SCREEN */
    #result-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(10, 10, 20, 0.95);
      backdrop-filter: blur(10px);
      z-index: 50;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    #result-screen.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .result-content {
      background: var(--glass-bg);
      padding: 3rem;
      border-radius: 20px;
      border: 1px solid var(--glass-border);
      text-align: center;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 0 50px rgba(178, 73, 248, 0.2);
    }

    /* MOBILE OPTIMIZATION */
    @media (max-width: 600px) {
      h1 {
        font-size: 2.5rem;
      }

      .hero-card {
        padding: 2rem 1.5rem;
      }

      section {
        padding: 1.5rem;
      }

      .score-val {
        font-size: 1.5rem;
      }

      .ctrl-btn {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
      }
    }

    footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.8rem;
      opacity: 0.6;
      background: #000;
    }

    footer a {
      color: var(--secondary-color);
      text-decoration: none;
    }
  </style>
</head>

<body>

  <!-- 1. Background Game -->
  <canvas id="game-canvas"></canvas>

  <!-- 2. Main Content Site (Scrollable) -->
  <div id="content-layer">

    <div class="hero-section">
      <div class="hero-card">
        <h1>Life Garden</h1>
        <p class="subtitle">
          ãƒ©ã‚¤ãƒ•ã‚²ãƒ¼ãƒ ã®å¢—æ®–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã€Œè‚²ã¦ã¦ã€ã‚¹ã‚³ã‚¢ã‚’ç«¶ã†ã€‚<br>
          ã‚·ãƒ³ãƒ—ãƒ«ã§å¥¥æ·±ã„ã€ãƒ–ãƒ©ã‚¦ã‚¶è‚²æˆãƒ‘ã‚ºãƒ«ã€‚
        </p>
        <button id="hero-start-btn" class="btn-start">GAME START</button>

        <div class="privacy-link-container">
          <a href="privacy.html">Privacy Policy</a>
        </div>
      </div>
      <div style="margin-top: 1rem;">
        <span style="font-size: 0.8rem; opacity: 0.7;">â†“ SCROLL FOR INFO</span>
      </div>
    </div>

    <div class="container">
      <section id="about">
        <h2>Life Garden ã¨ã¯ï¼Ÿ</h2>
        <p>
          Life Garden ã¯ã€ã‚³ãƒ³ã‚¦ã‚§ã‚¤ã®ãƒ©ã‚¤ãƒ•ã‚²ãƒ¼ãƒ ã‚’åœŸå°ã«ã—ã¤ã¤ã€
          ã€Œã‚¹ã‚³ã‚¢ã€ã€Œãƒ«ãƒ¼ãƒ—æ¤œå‡ºã€ã€Œãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®‰å®šæ€§ã€ãªã©ã‚’ã‚²ãƒ¼ãƒ ã¨ã—ã¦æ¥½ã—ã‚ã‚‹ã‚ˆã†ã«èª¿æ•´ã—ãŸãƒ–ãƒ©ã‚¦ã‚¶ã‚²ãƒ¼ãƒ ã§ã™ã€‚
        </p>
        <div class="note">
          ç”Ÿãã¦ã„ã‚‹ã‚»ãƒ«ãŒ2ã€œ3å€‹ã§ç”Ÿå­˜ã€3å€‹ã§èª•ç”Ÿã€‚ãã‚Œä»¥å¤–ã¯æ·˜æ±°ã•ã‚Œã‚‹ã€‚<br>
          ãŸã£ãŸã“ã‚Œã ã‘ã®ãƒ«ãƒ¼ãƒ«ã‹ã‚‰ã€é©šãã»ã©è¤‡é›‘ãªå®‡å®™ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚
        </div>
      </section>

      <section id="howto">
        <h2>éŠã³æ–¹ã¨æˆ¦ç•¥</h2>
        <h3>1. ç¨®ã‚’ã¾ã (Plant)</h3>
        <p>
          ç›¤é¢ã‚’ã‚¿ãƒƒãƒ—ãƒ»ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã‚»ãƒ«ã‚’è‡ªç”±ã«é…ç½®ã—ã¾ã™ã€‚
          ã“ã‚ŒãŒã‚ãªãŸã®ã€Œç¨®ã€ã§ã™ã€‚
        </p>

        <h3>2. è‚²ã¦ã‚‹ (Grow)</h3>
        <p>
          å†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ä¸–ä»£ãŒé€²ã¿ã¾ã™ã€‚
          ã©ã“ã¾ã§åºƒãŒã‚‹ã‹ã€ã„ã¤ã¾ã§ç”Ÿãæ®‹ã‚‹ã‹ã‚’è¦‹å®ˆã‚Šã¾ã—ã‚‡ã†ã€‚
        </p>

        <h3>3. ã‚¹ã‚³ã‚¢ (Score)</h3>
        <p>
          ã‚¹ã‚³ã‚¢ã¯ <code>(ä¸–ä»£æ•° Ã— 10) + (æœ€å¤§å€‹ä½“æ•° Ã— 5)</code> ã§æ±ºã¾ã‚Šã¾ã™ã€‚
          ãŸã é•·ç”Ÿãã™ã‚‹ã ã‘ã§ãªãã€<strong>ä¸€ç¬ã®ã€Œçˆ†ç™ºçš„ãªåºƒãŒã‚Šã€</strong>ã‚’æŒãŸã›ã‚‹ã“ã¨ãŒé«˜å¾—ç‚¹ã®éµã§ã™ã€‚
        </p>
      </section>

      <section>
        <h2>é–‹ç™ºè€…ã‚ˆã‚Š</h2>
        <p>
          ä¸å…·åˆã‚„ã”æ„è¦‹ã¯ X (Twitter) ç­‰ã§ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚
        </p>
      </section>
    </div>

    <footer>
      Â© 2025 Ikuto Yamaguchi | <a href="privacy.html">Privacy Policy</a>
    </footer>
  </div>

  <!-- 3. Game Interface (Visible only in Game Mode) -->
  <div id="game-interface" class="hidden">
    <button id="btn-exit">â† QUIT</button>

    <div id="hud">
      <div class="score-display">
        <div class="score-label">SCORE</div>
        <div class="score-val" id="disp-score">0</div>
      </div>
      <div class="score-display" style="text-align: right;">
        <div class="score-label">GENERATION</div>
        <div class="score-val" id="disp-gen">0</div>
      </div>
    </div>

    <div id="controls">
      <button class="ctrl-btn" id="btn-reset" title="Reset">â†»</button>
      <button class="ctrl-btn" id="btn-toggle" title="Play/Pause">â–¶</button>
      <button class="ctrl-btn" id="btn-snap" title="Snapshot">ğŸ“·</button>
    </div>
  </div>

  <!-- 4. Result Overlay -->
  <div id="result-screen">
    <div class="result-content">
      <h2 id="res-reason" style="color:var(--secondary-color)">GAME OVER</h2>
      <div style="font-size:3.5rem; font-weight:800; margin:1rem 0;" id="res-score">0</div>
      <div style="margin-bottom:2rem; opacity:0.8;">
        Generations: <span id="res-gen-val">0</span><br>
        Max Pop: <span id="res-pop-val">0</span>
      </div>
      <button class="btn-start" id="btn-retry">RETRY</button>
      <br>
      <button
        style="background:none; border:none; color:white; margin-top:1rem; cursor:pointer; text-decoration:underline;"
        onclick="app.exitGame()">Back to Home</button>
    </div>
  </div>

  <script>
    // Main Application Controller
    const app = {
      isGameMode: false,

      init() {
        // Event Bindings
        document.getElementById('hero-start-btn').addEventListener('click', () => this.enterGame());
        document.getElementById('btn-exit').addEventListener('click', () => this.exitGame());
        document.getElementById('btn-retry').addEventListener('click', () => {
          document.getElementById('result-screen').classList.remove('visible');
          game.reset();
        });

        // Game Controls
        document.getElementById('btn-reset').addEventListener('click', () => game.reset());
        document.getElementById('btn-toggle').addEventListener('click', () => game.toggle());
        document.getElementById('btn-snap').addEventListener('click', () => game.snapshot());

        // Start background simulation
        game.init();
      },

      enterGame() {
        this.isGameMode = true;
        window.scrollTo(0, 0); // Reset scroll
        document.body.classList.add('game-mode');
        document.getElementById('content-layer').classList.add('hidden');
        document.getElementById('game-interface').classList.remove('hidden');

        // Reset game for clean start
        game.startMatch();
      },

      exitGame() {
        this.isGameMode = false;
        document.body.classList.remove('game-mode');
        document.getElementById('content-layer').classList.remove('hidden');
        document.getElementById('game-interface').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('visible');

        // Back to chill background mode
        game.toBackgroundMode();
      }
    };

    // Game Engine
    const game = {
      canvas: null,
      ctx: null,
      grid: [],
      nextGrid: [],
      cols: 0,
      rows: 0,
      res: 20,

      state: 'BG', // BG (Background), SETUP, RUNNING, RESULT

      gen: 0,
      score: 0,
      maxPop: 0,
      history: [],

      // Loop Detection
      lastPop: 0,
      stableFrames: 0,

      init() {
        this.canvas = document.getElementById('game-canvas');
        this.ctx = this.canvas.getContext('2d', { alpha: false });

        window.addEventListener('resize', () => this.resize());
        this.resize();

        this.setupInput();

        // Initial State
        this.toBackgroundMode();
        this.loop();
      },

      resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
        // Responsive resolution
        this.res = window.innerWidth < 600 ? 15 : 20;

        this.cols = Math.ceil(this.canvas.width / this.res);
        this.rows = Math.ceil(this.canvas.height / this.res);

        this.grid = new Array(this.cols).fill(0).map(() => new Array(this.rows).fill(0));
        this.nextGrid = new Array(this.cols).fill(0).map(() => new Array(this.rows).fill(0));
      },

      toBackgroundMode() {
        this.state = 'BG';
        this.clear();
        this.randomize(0.12);
      },

      startMatch() {
        this.state = 'SETUP';
        this.clear();

        // Initial seed center
        let cx = Math.floor(this.cols / 2), cy = Math.floor(this.rows / 2);
        this.grid[cx][cy] = 1; this.grid[cx + 1][cy] = 1; this.grid[cx - 1][cy] = 1;
        this.grid[cx][cy - 1] = 1; this.grid[cx][cy + 1] = 1;

        this.resetStats();
        this.updateUI();
      },

      reset() {
        if (this.state === 'BG') return;
        this.state = 'SETUP';
        this.clear();
        this.resetStats();
        this.updateUI();
      },

      toggle() {
        if (this.state === 'SETUP') this.state = 'RUNNING';
        else if (this.state === 'RUNNING') this.state = 'SETUP';
        this.updateUI();
      },

      clear() {
        for (let i = 0; i < this.cols; i++) this.grid[i].fill(0);
      },

      randomize(p) {
        for (let i = 0; i < this.cols; i++) {
          for (let j = 0; j < this.rows; j++) {
            this.grid[i][j] = Math.random() < p ? 1 : 0;
          }
        }
      },

      resetStats() {
        this.gen = 0;
        this.score = 0;
        this.maxPop = 0;
        this.history = [];
        this.lastPop = 0;
        this.stableFrames = 0;
        this.updateHUD();
      },

      update() {
        if (this.state !== 'RUNNING' && this.state !== 'BG') return;

        let active = 0;
        let hash = "";

        for (let i = 0; i < this.cols; i++) {
          for (let j = 0; j < this.rows; j++) {
            let s = this.grid[i][j];
            let sum = 0;
            // Neighbors
            for (let x = -1; x <= 1; x++) {
              for (let y = -1; y <= 1; y++) {
                if (x === 0 && y === 0) continue;
                let c = (i + x + this.cols) % this.cols;
                let r = (j + y + this.rows) % this.rows;
                sum += this.grid[c][r];
              }
            }

            if (s === 0 && sum === 3) this.nextGrid[i][j] = 1;
            else if (s === 1 && (sum < 2 || sum > 3)) this.nextGrid[i][j] = 0;
            else this.nextGrid[i][j] = s;

            if (this.nextGrid[i][j] === 1) {
              active++;
              // Simple spatial sampling for hash (every 3rd pos)
              if (this.state === 'RUNNING' && (i + j) % 3 === 0) hash += (i + j).toString(16);
            }
          }
        }

        // Swap
        [this.grid, this.nextGrid] = [this.nextGrid, this.grid];

        if (this.state === 'RUNNING') {
          this.gen++;
          if (active > this.maxPop) this.maxPop = active;
          // Score with cap? No, score is fine if it ends
          this.score = (this.gen * 10) + (this.maxPop * 5);
          this.updateHUD();

          // 1. Extinction Check
          if (active === 0) {
            this.gameOver("EXTINCTION");
            return;
          }

          // 2. Exact Hash Loop Check (every 60 frames)
          if (this.gen % 60 === 0) {
            if (this.history.includes(hash)) {
              this.gameOver("LOOP DETECTED");
              return;
            }
            this.history.push(hash);
            if (this.history.length > 10) this.history.shift();
          }

          // 3. Population Stability Check (Catches Gliders/Stills)
          // If population doesn't change for 60 frames (1 sec) -> Stable/Boring
          if (active === this.lastPop) {
            this.stableFrames++;
            if (this.stableFrames > 60) {
              this.gameOver("STABILISED");
              return;
            }
          } else {
            this.stableFrames = 0;
            this.lastPop = active;
          }
        }
      },

      gameOver(reason) {
        this.state = 'RESULT';
        document.getElementById('res-reason').innerText = reason;
        document.getElementById('res-score').innerText = this.score;
        document.getElementById('res-gen-val').innerText = this.gen;
        document.getElementById('res-pop-val').innerText = this.maxPop;
        document.getElementById('result-screen').classList.add('visible');
      },

      draw() {
        // Fill BG
        this.ctx.fillStyle = '#0a0a0f';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

        // Cells
        this.ctx.fillStyle = this.state === 'BG' ? '#333' : '#b249f8'; // Dimmer in BG
        this.ctx.shadowBlur = this.state === 'BG' ? 0 : 10;
        this.ctx.shadowColor = '#b249f8';

        for (let i = 0; i < this.cols; i++) {
          for (let j = 0; j < this.rows; j++) {
            if (this.grid[i][j] === 1) {
              let x = i * this.res;
              let y = j * this.res;
              this.ctx.beginPath();
              this.ctx.rect(x + 1, y + 1, this.res - 2, this.res - 2);
              this.ctx.fill();
            }
          }
        }
      },

      loop() {
        // Throttling for BG mode to save battery
        if (this.state === 'BG') {
          if (Date.now() % 100 < 30) this.update();
        } else {
          this.update();
        }
        this.draw();
        requestAnimationFrame(() => this.loop());
      },

      setupInput() {
        let isDrag = false;
        const plot = (cx, cy) => {
          // Allow drawing in BG mode (fun) or SETUP mode
          if (this.state !== 'SETUP' && this.state !== 'BG') return;

          let i = Math.floor(cx / this.res);
          let j = Math.floor(cy / this.res);
          if (i >= 0 && i < this.cols && j >= 0 && j < this.rows) {
            this.grid[i][j] = 1;
          }
        };

        this.canvas.addEventListener('mousedown', e => { isDrag = true; plot(e.clientX, e.clientY); });
        window.addEventListener('mouseup', () => isDrag = false);
        this.canvas.addEventListener('mousemove', e => { if (isDrag) plot(e.clientX, e.clientY); });

        this.canvas.addEventListener('touchstart', e => {
          isDrag = true; plot(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });
        window.addEventListener('touchend', () => isDrag = false);
        this.canvas.addEventListener('touchmove', e => {
          if (isDrag) plot(e.touches[0].clientX, e.touches[0].clientY);
          e.preventDefault(); // Stop scroll when drawing on canvas
        }, { passive: false });
      },

      snapshot() {
        const d = this.canvas.toDataURL('image/png');
        const a = document.createElement('a');
        a.download = `lifegarden-${this.score}.png`;
        a.href = d;
        a.click();
      },

      updateHUD() {
        document.getElementById('disp-score').innerText = this.score;
        document.getElementById('disp-gen').innerText = this.gen;
      },

      updateUI() {
        const btn = document.getElementById('btn-toggle');
        if (this.state === 'RUNNING') {
          btn.innerText = 'â¸';
          btn.classList.remove('active');
        } else {
          btn.innerText = 'â–¶';
          btn.classList.add('active');
        }
      }
    };

    // Initialize when DOM ready
    window.addEventListener('DOMContentLoaded', () => {
      app.init();
    });

  </script>
</body>

</html>