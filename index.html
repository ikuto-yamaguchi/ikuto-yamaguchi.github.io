<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>Life Garden | „É©„Ç§„Éï„Ç≤„Éº„É†ËÇ≤Êàê„Éë„Ç∫„É´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="„Ç∑„É≥„Éó„É´„ÅßÁæé„Åó„ÅÑ„ÄÅ„Éñ„É©„Ç¶„Ç∂„ÅßÈÅä„Åπ„Çã„É©„Ç§„Éï„Ç≤„Éº„É†„ÄÇ„Éë„Çø„Éº„É≥„ÇíËÇ≤„Å¶„Å¶„ÄÅ„Ç∑„Çß„Ç¢„Åó„Çà„ÅÜ„ÄÇ">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;800&display=swap" rel="stylesheet">

  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6799951658165737"
    crossorigin="anonymous"></script>

  <style>
    :root {
      --bg-color: #0a0a0f;
      --primary-color: #b249f8;
      /* Neon Purple */
      --secondary-color: #49f8f8;
      /* Neon Cyan */
      --text-color: #ffffff;
      --glass-bg: rgba(20, 20, 30, 0.85);
      --glass-border: rgba(255, 255, 255, 0.15);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      /* Prevent text selection during play */
    }

    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Outfit', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      width: 100vw;
      height: 100vh;
    }

    #game-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    /* UI Layers */
    .layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .hidden {
      opacity: 0 !important;
      pointer-events: none !important;
      transform: scale(0.95);
    }

    /* Title Screen */
    .title-card {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      padding: 2.5rem 3.5rem;
      border-radius: 24px;
      border: 1px solid var(--glass-border);
      text-align: center;
      pointer-events: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      max-width: 90%;
      animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    h1 {
      font-size: 3.2rem;
      margin: 0 0 0.5rem;
      background: linear-gradient(135deg, #fff 30%, var(--primary-color) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(178, 73, 248, 0.4);
      letter-spacing: -0.02em;
    }

    p.subtitle {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 2rem;
      line-height: 1.5;
    }

    .btn-large {
      background: linear-gradient(135deg, var(--primary-color), #7c24cc);
      color: white;
      border: none;
      padding: 1rem 3rem;
      font-size: 1.3rem;
      font-weight: 700;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 0 20px rgba(178, 73, 248, 0.4);
      font-family: 'Outfit', sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .btn-large:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(178, 73, 248, 0.6);
    }

    .btn-large:active {
      transform: scale(0.98);
    }

    /* HUD (Top Bar) */
    #hud {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8) 0%, transparent 100%);
      z-index: 5;
      pointer-events: none;
    }

    .score-box {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .score-label {
      font-size: 0.7rem;
      opacity: 0.7;
      letter-spacing: 0.1em;
      margin-bottom: 2px;
    }

    .score-val {
      font-size: 1.5rem;
      font-weight: 700;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      font-variant-numeric: tabular-nums;
    }

    /* Controls (Bottom Bar) */
    #controls {
      position: fixed;
      bottom: 30px;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      pointer-events: auto;
      z-index: 20;
      padding-bottom: env(safe-area-inset-bottom);
    }

    .icon-btn {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: rgba(30, 30, 35, 0.85);
      border: 1px solid var(--glass-border);
      color: white;
      font-size: 1.6rem;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      transition: all 0.2s cubic-bezier(0.3, 1.5, 0.5, 1);
    }

    .icon-btn:hover {
      background: var(--primary-color);
      transform: translateY(-4px);
    }

    .icon-btn:active {
      transform: translateY(0) scale(0.95);
    }

    .icon-btn.primary {
      background: var(--primary-color);
      box-shadow: 0 0 20px rgba(178, 73, 248, 0.6);
      border-color: rgba(255, 255, 255, 0.4);
    }

    /* Result Overlay */
    #result-screen h2 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .result-score {
      font-size: 4.5rem;
      font-weight: 800;
      background: linear-gradient(to bottom, #fff, var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0.5rem 0 1.5rem;
      text-shadow: 0 0 30px rgba(73, 248, 248, 0.3);
      line-height: 1;
    }

    .result-stats {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 2rem;
      justify-content: center;
    }

    .stat-col {
      text-align: center;
    }

    .stat-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      opacity: 0.6;
      margin-bottom: 4px;
    }

    .stat-val {
      font-size: 1.4rem;
      font-weight: 600;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Message Toast */
    #toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1.2rem;
      font-weight: 600;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      border: 1px solid var(--primary-color);
      text-shadow: 0 0 10px var(--primary-color);
    }

    /* Mobile Adjustments */
    @media (max-width: 600px) {
      h1 {
        font-size: 2.2rem;
      }

      .title-card {
        padding: 1.5rem;
        width: 90%;
      }

      .btn-large {
        padding: 0.8rem 2rem;
        font-size: 1.1rem;
      }

      .result-score {
        font-size: 3.5rem;
      }

      .icon-btn {
        width: 56px;
        height: 56px;
        font-size: 1.4rem;
      }

      #controls {
        bottom: 20px;
        gap: 1rem;
      }

      #hud {
        padding: 10px 15px;
      }
    }
  </style>
</head>

<body>

  <canvas id="game-canvas"></canvas>

  <!-- Title Screen -->
  <div id="title-layer" class="layer">
    <div class="title-card">
      <h1>Life Garden</h1>
      <p class="subtitle">Á®Æ„Çí„Åæ„Åç„ÄÅËÇ≤„Å¶„ÄÅÁæé„Åó„Åï„ÇíÁ´∂„ÅÜ„ÄÇ<br>„Ç∑„É≥„Éó„É´„ÅßÂ••Ê∑±„ÅÑËÇ≤Êàê„Éë„Ç∫„É´„ÄÇ</p>
      <button class="btn-large" onclick="game.start()">GAME START</button>
      <div style="margin-top: 2rem; font-size: 0.8rem; opacity: 0.6;">
        <a href="privacy.html"
          style="color:white; text-decoration: none; border-bottom: 1px solid rgba(255,255,255,0.3);">Privacy Policy</a>
      </div>
    </div>
  </div>

  <!-- Gameplay UI -->
  <div id="game-ui" class="layer hidden" style="pointer-events: none;">
    <div id="hud">
      <div class="score-box">
        <div class="score-label">SCORE</div>
        <div class="score-val" id="score-val" style="color: var(--secondary-color);">0</div>
      </div>
      <div class="score-box" style="align-items: flex-end;">
        <div class="score-label">GEN</div>
        <div class="score-val" id="gen-val">0</div>
      </div>
    </div>

    <div id="toast">TAP TO PLANT</div>
  </div>

  <!-- Controls -->
  <div id="controls" class="hidden">
    <button class="icon-btn" onclick="game.reset()" title="Reset">‚Üª</button>
    <button class="icon-btn primary" id="btn-play" onclick="game.toggle()" title="Run Simulation">‚ñ∂</button>
    <button class="icon-btn" onclick="game.snapshot()" title="Share">üì∑</button>
  </div>

  <!-- Result Screen -->
  <div id="result-layer" class="layer hidden">
    <div class="title-card" id="result-card">
      <h2 id="result-title">Result</h2>
      <div class="result-score" id="final-score">0</div>

      <div class="result-stats">
        <div class="stat-col">
          <div class="stat-label">Generations</div>
          <div class="stat-val" id="res-gen">0</div>
        </div>
        <div class="stat-col">
          <div class="stat-label">Max Pop</div>
          <div class="stat-val" id="res-pop">0</div>
        </div>
      </div>

      <button class="btn-large" onclick="game.retry()">RETRY</button>
    </div>
  </div>

  <script>
    /**
     * Life Garden Game Engine
     */
    const Game = {
      canvas: null,
      ctx: null,
      cols: 0,
      rows: 0,
      res: 20,
      grid: [],
      nextGrid: [],
      state: 'TITLE', // TITLE, SETUP, RUNNING, RESULT

      // Stats
      generation: 0,
      maxPop: 0,
      score: 0,

      // Loop Detection
      history: [],

      // Animation
      animId: null,
      lastFrame: 0,
      fps: 60,

      init() {
        this.canvas = document.getElementById('game-canvas');
        this.ctx = this.canvas.getContext('2d', { alpha: false });

        window.addEventListener('resize', () => this.resize());
        this.resize();

        // Input
        this.setupInput();

        // Start Loop
        this.randomize(0.1); // Demo background
        this.loop();
      },

      resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
        // Adjust cell size based on screen area
        this.res = Math.sqrt((window.innerWidth * window.innerHeight) / 2000);
        if (this.res < 16) this.res = 16;
        if (this.res > 30) this.res = 30;

        this.cols = Math.ceil(this.canvas.width / this.res);
        this.rows = Math.ceil(this.canvas.height / this.res);

        this.grid = new Array(this.cols).fill(0).map(() => new Array(this.rows).fill(0));
        this.nextGrid = new Array(this.cols).fill(0).map(() => new Array(this.rows).fill(0));
      },

      randomize(density) {
        for (let i = 0; i < this.cols; i++) {
          for (let j = 0; j < this.rows; j++) {
            this.grid[i][j] = Math.random() < density ? 1 : 0;
          }
        }
      },

      clear() {
        for (let i = 0; i < this.cols; i++) this.grid[i].fill(0);
      },

      start() {
        this.state = 'SETUP';
        this.clear();

        // Initial cross pattern in center
        const cx = Math.floor(this.cols / 2);
        const cy = Math.floor(this.rows / 2);
        this.grid[cx][cy] = 1; this.grid[cx + 1][cy] = 1; this.grid[cx - 1][cy] = 1;
        this.grid[cx][cy + 1] = 1; this.grid[cx][cy - 1] = 1;

        this.transitionUI('game-ui');
        this.showToast("TAP TO PLANT");
        this.updateBtn();
        this.resetStats();
      },

      retry() {
        document.getElementById('result-layer').classList.add('hidden');
        this.start();
      },

      reset() {
        if (this.state === 'RESULT') {
          this.retry();
        } else {
          this.state = 'SETUP';
          this.clear();
          this.resetStats();
          this.updateBtn();
        }
      },

      toggle() {
        if (this.state === 'SETUP') {
          this.state = 'RUNNING';
          this.showToast("RUNNING");
        } else if (this.state === 'RUNNING') {
          this.state = 'SETUP';
          this.showToast("PAUSED");
        }
        this.updateBtn();
      },

      resetStats() {
        this.generation = 0;
        this.maxPop = 0;
        this.score = 0;
        this.history = [];
        this.updateHud();
      },

      update() {
        if (this.state !== 'RUNNING' && this.state !== 'TITLE') return;

        let activeCells = 0;
        let hash = "";

        for (let i = 0; i < this.cols; i++) {
          for (let j = 0; j < this.rows; j++) {
            let state = this.grid[i][j];

            // Count neighbors
            let sum = 0;
            for (let x = -1; x < 2; x++) {
              for (let y = -1; y < 2; y++) {
                if (x === 0 && y === 0) continue;
                let col = (i + x + this.cols) % this.cols;
                let row = (j + y + this.rows) % this.rows;
                sum += this.grid[col][row];
              }
            }

            // Rule
            if (state === 0 && sum === 3) this.nextGrid[i][j] = 1;
            else if (state === 1 && (sum < 2 || sum > 3)) this.nextGrid[i][j] = 0;
            else this.nextGrid[i][j] = state;

            if (this.nextGrid[i][j] === 1) {
              activeCells++;
              // Simple spatial hash for loop check using only a few cells
              if (this.state === 'RUNNING' && (i + j) % 3 === 0) hash += (i * this.rows + j).toString(36);
            }
          }
        }

        // Swap
        [this.grid, this.nextGrid] = [this.nextGrid, this.grid];

        if (this.state === 'RUNNING') {
          this.generation++;
          if (activeCells > this.maxPop) this.maxPop = activeCells;
          // Score: Survival Time * 10 + Max Population * 5
          this.score = (this.generation * 10) + (this.maxPop * 5);
          this.updateHud();

          // Checks
          if (activeCells === 0) this.gameOver("EXTINCTION");

          // Loop check (every 60 frames to save perf)
          if (this.generation % 30 === 0) {
            if (this.history.includes(hash)) {
              // Simple check found match
              this.gameOver("LOOP DETECTED");
            }
            this.history.push(hash);
            if (this.history.length > 10) this.history.shift();
          }
        }
      },

      gameOver(reason) {
        this.state = 'RESULT';
        document.getElementById('result-title').innerText = reason;
        document.getElementById('final-score').innerText = this.score;
        document.getElementById('res-gen').innerText = this.generation;
        document.getElementById('res-pop').innerText = this.maxPop;

        document.getElementById('game-ui').classList.add('hidden');
        document.getElementById('controls').classList.add('hidden');
        document.getElementById('result-layer').classList.remove('hidden');
      },

      render() {
        // Clear
        this.ctx.fillStyle = '#0a0a0f'; // BG Color
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

        // Glow effect setup
        this.ctx.shadowBlur = 10;
        this.ctx.shadowColor = '#b249f8';
        this.ctx.fillStyle = '#b249f8';

        for (let i = 0; i < this.cols; i++) {
          for (let j = 0; j < this.rows; j++) {
            if (this.grid[i][j] === 1) {
              this.ctx.beginPath();
              // Optimize: Draw Rectangle instead of round rect for speed if needed, 
              // but round rect looks better.
              let x = i * this.res;
              let y = j * this.res;
              this.ctx.roundRect(x + 1, y + 1, this.res - 2, this.res - 2, 4);
              this.ctx.fill();
            }
          }
        }
        this.ctx.shadowBlur = 0;
      },

      loop(now) {
        // Throttling for "Title" to be chill
        if (this.state === 'TITLE') {
          // Update every 3rd frame
          if (this.generation % 3 === 0) this.update();
          this.generation++; // Just for frame count in title
        } else {
          this.update();
        }

        this.render();
        requestAnimationFrame(t => this.loop(t));
      },

      // Interaction
      setupInput() {
        let isDrag = false;
        const handle = (x, y) => {
          if (this.state !== 'SETUP') return;
          let i = Math.floor(x / this.res);
          let j = Math.floor(y / this.res);
          if (i >= 0 && i < this.cols && j >= 0 && j < this.rows) {
            this.grid[i][j] = 1;
          }
        };

        this.canvas.addEventListener('mousedown', e => { isDrag = true; handle(e.clientX, e.clientY); });
        window.addEventListener('mouseup', () => isDrag = false);
        this.canvas.addEventListener('mousemove', e => { if (isDrag) handle(e.clientX, e.clientY); });

        this.canvas.addEventListener('touchstart', e => {
          isDrag = true;
          handle(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });
        window.addEventListener('touchend', () => isDrag = false);
        this.canvas.addEventListener('touchmove', e => {
          if (isDrag) handle(e.touches[0].clientX, e.touches[0].clientY);
          e.preventDefault();
        }, { passive: false });
      },

      transitionUI(activeId) {
        ['title-layer', 'game-ui', 'controls', 'result-layer'].forEach(id => {
          const el = document.getElementById(id);
          if (id === activeId || (id === 'controls' && activeId === 'game-ui')) {
            el.classList.remove('hidden');
          } else {
            el.classList.add('hidden');
          }
        });
      },

      showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.style.opacity = '1';
        setTimeout(() => t.style.opacity = '0', 1500);
      },

      updateHud() {
        document.getElementById('score-val').innerText = this.score;
        document.getElementById('gen-val').innerText = this.generation;
      },

      updateBtn() {
        const btn = document.getElementById('btn-play');
        if (this.state === 'RUNNING') {
          btn.innerText = '‚è∏';
          btn.classList.remove('primary');
        } else {
          btn.innerText = '‚ñ∂';
          btn.classList.add('primary');
        }
      },

      snapshot() {
        const d = this.canvas.toDataURL('image/png');
        const a = document.createElement('a');
        a.download = `lifegarden-${this.score}.png`;
        a.href = d;
        a.click();
      }
    };

    // Start
    Game.init();

  </script>
</body>

</html>